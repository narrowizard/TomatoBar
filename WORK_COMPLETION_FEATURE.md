# 番茄钟完成记录功能

## 功能概述

这个功能允许用户在完成每个番茄钟后记录他们的工作内容，并可以选择将数据上传到自定义服务器。

## 使用方法

1. **完成番茄钟**：当一个番茄钟（工作时间）完成时，会自动弹出一个记录窗口
2. **填写内容**：
   - 工作内容：描述在这个番茄钟中完成的工作
   - 标签：添加相关标签，用逗号分隔
3. **选择操作**：
   - **提交**：保存记录并尝试上传到配置的API端点
   - **跳过**：不保存任何内容，直接关闭窗口
   - **取消**：关闭窗口，不进行任何操作

## API 配置

### 设置端点

在应用设置的"API端点"部分输入你的服务器地址：
- 留空：数据将只保存在本地
- 输入URL：数据将尝试上传到指定地址

### API 规范

你的API端点需要接受POST请求，Content-Type为application/json。

#### 请求数据格式
```json
{
  "description": "完成了项目文档的编写",
  "tags": ["文档", "项目", "写作"],
  "timestamp": "2023-12-01T10:30:00Z",
  "app_version": "3.0"
}
```

#### 响应格式
- 成功：HTTP状态码 200-299
- 失败：其他状态码或网络错误

### 错误处理

如果上传失败，数据会自动保存在本地。你可以通过以下方式访问本地数据：

```swift
// 获取本地保存的记录
let completions = WorkCompletionService.shared.getLocalWorkCompletions()
```

## 本地数据存储

所有记录（包括上传成功的）都会保存在本地UserDefaults中，最多保留100条记录。数据以JSON格式存储，包含：
- 工作描述
- 标签列表
- 时间戳

## 隐私说明

- 工作记录仅保存在本地设备上
- 只有配置了API端点时才会尝试上传数据
- 所有网络请求都通过HTTPS进行
- 用户可以随时清空本地数据

## 开发者说明

### 添加新功能

要扩展工作记录功能，可以修改以下文件：
- `WorkCompletionView.swift`：修改UI界面
- `WorkCompletionService.swift`：修改数据上传逻辑
- `Timer.swift`：修改触发时机

### 自定义字段

要添加新的记录字段，需要：
1. 修改 `WorkCompletionData` 结构
2. 更新 `WorkCompletionView` 界面
3. 修改 `WorkCompletionService` 中的数据格式化逻辑

### 测试

测试模式下的数据不会真正上传，只会模拟网络请求延迟。要测试完整功能，需要：
1. 配置一个测试API端点
2. 运行完整的番茄钟流程
3. 验证数据是否正确上传